#!/bin/bash
# run-tests - script to run ncc tests

NCC=bin/ncc

# TestMode($1 = Mode, $2 = Argument)
TestMode()
{
	echo -e "\nRunning $1 tests...\n"

	for i in `ls tests/$1/reference-output/`
	do
		$NCC $2 tests/$1/$i.c &> tests/$1/output/$i
		if diff -u --strip-trailing-cr tests/$1/reference-output/$i tests/$1/output/$i
		then
			echo "OK - $i"
		else
			echo "FAILED - $i"
		fi
	done
}

if [[ ! -x $NCC ]]
then
	echo "Build the compiler by running make first"
	exit
fi

TestMode scanner -S
TestMode parser -P
